<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - Coillect</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="stylesheet" href="dashboard.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body class="phone-frame">

  <div class="mobile-wrapper">
  <div class="container py-4">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h5 class="mb-0 fw-semibold">
         <img src="assets/images/Group 4.png" alt="" style="height: 45px;">
        Bem-vindo, Usuário</h5>
      <div class="dropdown">
        <button class="btn btn-outline-light btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="bi bi-person-circle"></i>
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><a class="dropdown-item" href="#" onclick="ajuda()"><i class="bi bi-question-circle me-2"></i>Ajuda</a></li>
          <li><a class="dropdown-item" href="#" onclick="logout()"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
        </ul>
      </div>
    </div>

    <!-- Mapa -->
    <div id="mapa" class="mb-4 shadow-sm rounded-4 fade-in-delayed" style="z-index: 0;"></div>

    <!-- Botões -->
     <!-- Spinner de loading -->
    <div id="loadingSpinner" class="fade-in-delayed">
      <div class="spinner-border text-light" role="status">
        <span class="visually-hidden">Carregando...</span>
      </div>
      <p class="mt-2">Solicitando coleta...</p>
    </div>
    <div class="d-grid gap-3 mb-4 fade-in-delayed">
      <button id="btnSolicitar" class="btn btn-success btn-lg rounded-3 shadow-sm" onclick="solicitarColeta()">
        <i class="bi bi-truck me-2"></i>Solicitar Coleta
      </button>

      <button id="btnCancelar" class="btn btn-warning btn-lg rounded-3 shadow-sm d-none" data-bs-toggle="modal" data-bs-target="#modalCancelar">
        <i class="bi bi-x-circle me-2"></i>Cancelar Coleta
      </button>
    </div>

    <!-- Informações -->
    <div class="card shadow-sm border-0 rounded-4 fade-in-delayed">
      <div class="card-body">
        <h6 class="card-title fw-semibold mb-2"><i class="bi bi-info-circle me-2"></i>Informações da Coleta</h6>
        <p class="card-text" id="infoColeta">Nenhuma coleta em andamento.</p>
      </div>
    </div>

        <!-- Modal de Confirmação -->
    <div class="modal fade" id="modalCancelar" tabindex="-1" aria-labelledby="modalCancelarLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-white border border-warning rounded-4">
          <div class="modal-header">
            <h5 class="modal-title text-warning" id="modalCancelarLabel"><i class="bi bi-exclamation-triangle me-2"></i>Confirmar Cancelamento</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
          </div>
          <div class="modal-body">
            Tem certeza que deseja cancelar a coleta?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Voltar</button>
            <button type="button" class="btn btn-warning" onclick="cancelarColeta()" data-bs-dismiss="modal">
              <i class="bi bi-x-circle me-1"></i>Cancelar Coleta
            </button>
          </div>
        </div>
      </div>
    </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    let coletaAtiva = false;

    function solicitarColeta() {
      document.getElementById("loadingSpinner").style.display = "block";
      document.getElementById("btnSolicitar").classList.add("d-none");

      setTimeout(() => {
        coletaAtiva = true;
        document.getElementById("loadingSpinner").style.display = "none";
        document.getElementById("btnCancelar").classList.remove("d-none");

        document.getElementById("infoColeta").innerHTML = `
          <i class="bi bi-hourglass-split me-1"></i>
          <strong>Status:</strong> Coleta solicitada. Aguardando confirmação.
        `;
      }, 2000); 
    }

    function confirmarCancelamento() {
      if (confirm("Tem certeza que deseja cancelar a coleta?")) {
        cancelarColeta();
      }
    }

    function cancelarColeta() {
      coletaAtiva = false;
      document.getElementById("btnCancelar").classList.add("d-none");
      document.getElementById("btnSolicitar").classList.remove("d-none");

      document.getElementById("infoColeta").innerHTML = `
        <i class="bi bi-x-octagon me-1"></i>
        <strong>Status:</strong> Coleta cancelada.
      `;
    }

    function logout() {
      window.location.href = "login.html";
    }

    function ajuda() {
      alert("Entre em contato pelo suporte@coillect.com ou consulte nossa central de ajuda.");
    }

    const mapa = L.map('mapa').setView([-23.5505, -46.6333], 13);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; <a href="https://carto.com/">CARTO</a>',
      subdomains: 'abcd',
      maxZoom: 19
    }).addTo(mapa);

        const animatedDiv = L.divIcon({
      className: '',
      html: '<div class="animated-marker"></div>',
      iconSize: [20, 20],
      iconAnchor: [10, 10]
    });

    L.marker([-23.5505, -46.6333], { icon: animatedDiv }).addTo(mapa)
      .bindPopup('Sua localização')
      .openPopup();
  </script>
</body>
</html>
